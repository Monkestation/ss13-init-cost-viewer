<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>SS13 Init Log Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Open Graph / Discord Embed -->
    <meta property="og:title" content="SS13 Init Cost Viewer" />
    <meta
      property="og:description"
      content="View atom init costs in browser, in a similar design as the in-game Runtime viewer."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://monkestation.github.io/ss13-init-cost-viewer/" />
    <meta property="og:image" content="https://monkestation.github.io/ss13-init-cost-viewer/preview.png" />
    <meta property="og:site_name" content="SS13 Init Cost Viewer" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="SS13 Init Cost Viewer" />
    <meta
      name="twitter:description"
      content="View atom init costs in browser, in a similar design as the in-game Runtime viewer."
    />
    <meta name="twitter:image" content="https://monkestation.github.io/ss13-init-cost-viewer/preview.png" />

    <meta name="theme-color" content="#7A89BF" />
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/marked@16.4.1/lib/marked.umd.js"></script>
  </head>
  <style>
    body {
      padding: 0;
      margin: 0;
      background-color: #272727;
      font-size: 12px;
      color: #ffffff;
      line-height: 170%;
    }

    hr {
      background-color: #40628a;
      height: 2px;
      border: 0;
    }

    a,
    button,
    a:link,
    a:visited,
    a:active,
    .linkOn,
    .linkOff {
      color: #ffffff;
      text-decoration: none;
      background: #40628a;
      border: 1px solid #161616;
      padding: 1px 4px 1px 4px;
      margin: 0 2px 0 0;
      cursor: default;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    a:hover {
      color: #40628a;
      background: #ffffff;
    }

    a.inlineblock {
      display: inline-block;
    }

    a.white,
    a.white:link,
    a.white:visited,
    a.white:active {
      color: #40628a;
      text-decoration: none;
      background: #ffffff;
      border: 1px solid #161616;
      padding: 1px 4px 1px 4px;
      margin: 0 2px 0 0;
      cursor: default;
    }

    a.white:hover {
      color: #ffffff;
      background: #40628a;
    }

    .linkOn,
    a.linkOn:link,
    a.linkOn:visited,
    a.linkOn:active,
    a.linkOn:hover {
      color: #ffffff;
      background: #2f943c;
      border-color: #24722e;
    }

    .linkOff,
    a.linkOff:link,
    a.linkOff:visited,
    a.linkOff:active,
    a.linkOff:hover {
      color: #ffffff;
      background: #999999;
      border-color: #666666;
    }

    a.icon,
    .linkOn.icon,
    .linkOff.icon {
      position: relative;
      padding: 1px 4px 2px 20px;
    }

    a.icon img,
    .linkOn.icon img {
      position: absolute;
      top: 0;
      left: 0;
      width: 18px;
      height: 18px;
    }

    ul {
      padding: 4px 0 0 10px;
      margin: 0;
      list-style-type: none;
    }

    li {
      padding: 0 0 2px 0;
    }

    img,
    a img {
      border-style: none;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 0;
      padding: 2px 0 4px 0;
      color: #517087;
    }

    h1 {
      font-size: 15px;
    }

    h2 {
      font-size: 14px;
    }

    h3 {
      font-size: 13px;
    }

    h4 {
      font-size: 12px;
    }

    .uiWrapper {
      width: 100%;
      height: 100%;
    }

    .uiTitle {
      clear: both;
      padding: 6px 8px 6px 8px;
      border-bottom: 2px solid #161616;
      background: #383838;
      color: #98b0c3;
      font-size: 16px;
    }

    .uiTitle.icon {
      padding: 6px 8px 6px 42px;
      background-position: 2px 50%;
      background-repeat: no-repeat;
    }

    .uiContent {
      clear: both;
      padding: 8px;
      font-family: Verdana, Geneva, sans-serif;
    }
    .block {
      padding: 8px;
      margin: 10px 4px 4px 4px;
      border: 1px solid #40628a;
      background-color: #202020;
    }

    .tree-node {
      margin-left: 20px;
      /* margin-top: 5px; */
    }
    .tree-item {
      cursor: pointer;
      /* padding: 3px 5px; */
      border-radius: 3px;
    }
    .tree-item:hover {
      background: #2d2d30;
    }
    .cost-high {
      color: #f48771;
      font-weight: bold;
    }
    .cost-med {
      color: #dcdcaa;
    }
    .cost-low {
      color: #4ec9b0;
    }
    .expander {
      display: inline-block;
      width: 15px;
    }
    .percentage {
      color: #858585;
      font-size: 0.9em;
    }
    .count {
      color: #9cdcfe;
      font-size: 0.9em;
    }
    .avg {
      color: #ce9178;
      font-size: 0.9em;
    }
    .summary {
      background: #252526;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .controls {
      background: #252526;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    /* .controls button {
        background: #0e639c;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 3px;
        cursor: pointer;
        margin-right: 10px;
      } */
    /* .controls button:hover {
        background: #1177bb;
      }
      .controls button.active {
        background: #1177bb;
      } */
    .tab-group {
      display: inline-block;
      /* margin-right: 20px; */
    }
    a,
    button,
    a:link,
    a:visited,
    a:active,
    .linkOn,
    .linkOff {
      color: #ffffff;
      text-decoration: none;
      background: #40628a;
      border: 1px solid #161616;
      padding: 1px 4px 1px 4px;
      margin: 0 2px 0 0;
      cursor: default;
      font-family: monospace;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    a:hover {
      color: #40628a;
      background: #ffffff;
    }

    a.white,
    a.white:link,
    a.white:visited,
    a.white:active {
      color: #40628a;
      text-decoration: none;
      background: #ffffff;
      border: 1px solid #161616;
      padding: 1px 4px 1px 4px;
      margin: 0 2px 0 0;
      cursor: default;
    }

    a.white:hover {
      color: #ffffff;
      background: #40628a;
    }

    .linkOn,
    a.linkOn:link,
    a.linkOn:visited,
    a.linkOn:active,
    a.linkOn:hover {
      color: #ffffff;
      background: #2f943c;
      border-color: #24722e;
    }

    .linkOff,
    a.linkOff:link,
    a.linkOff:visited,
    a.linkOff:active,
    a.linkOff:hover {
      color: #ffffff;
      background: #999999;
      border-color: #666666;
    }

    .statusDisplay {
      background: #000000;
      color: #ffffff;
      border: 1px solid #40628a;
      padding: 4px;
      margin: 3px 0;
    }

    .statusLabel,
    .statusDisplay b {
      width: 128px;
      float: left;
      overflow: hidden;
      color: #98b0c3;
    }

    .statusValue {
      float: left;
    }

    .runtime {
      background-color: #171717;
      border: solid 1px #202020;
      font-family: "Courier New";
      padding: 10px;
      color: #cccccc;
      display: grid;
    }
  </style>
  <body>
    <div class="uiTitleWrapper">
      <div class="uiTitle">
        <tt>SS13 Init Cost Viewer</tt> |
        <span style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-size: 12px">
          <a href="https://github.com/Monkestation/Monkestation2.0/pull/9444" target="_blank" rel="noopener noreferrer"
            >Game Code</a
          >
          |
          <a href="https://github.com/monkestation/ss13-init-cost-viewer/" target="_blank" rel="noopener noreferrer"
            >Repository</a
          >
          <div style="position: absolute; top: 8px; right: 8px; text-align: right">
            <select id="timeUnitSelect">
              <option value="ds">Deciseconds (ds)</option>
              <option value="ms">Milliseconds (ms)</option>
              <option value="s">Seconds (s)</option>
              <option value="us">Microseconds (Âµs)</option>
            </select>
            <input type="checkbox" style="margin-right: 4px" onclick="ilikenumbers();" />I like numbers :3
          </div>
        </span>
      </div>
    </div>

    <!-- <input type="button" value="Export JSON" onclick="exportJSON()" />
    <script>
      function exportJSON() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(window.DATA));
        const dlAnchorElem = document.createElement("a");
        dlAnchorElem.setAttribute("href", dataStr);
        dlAnchorElem.setAttribute("download", "init_costs_[MODE].json");
        document.body.appendChild(dlAnchorElem);
        dlAnchorElem.click();
        dlAnchorElem.remove();
      }
    </script>
    <a
      onclick="window.location.href = 'byond:\/\/?action=openLink&link=' + encodeURIComponent('https:\/\/monkestation.github.io/ss13-init-cost-viewer/');"
      href="#"
      >Website version</a
    > -->
    <div class="uiContent">
      <input type="file" id="fileInput" style="display: none" accept="application/json" />
      <a onclick='document.getElementById("fileInput").click();'>Load Init Log File</a>
      <a onclick="loadExampleFile();" alt="Load example file" title="Load example file">(?)</a>

      <script>
        document.getElementById("fileInput").addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = JSON.parse(e.target.result);
              if (!data.init || !data.late) {
                alert("Invalid file format: missing 'init' or 'late' sections.");
                return;
              }
              window.DATA = data;
              renderAll();
            } catch (err) {
              alert("Error parsing JSON: " + err.message);
            }
          };
          reader.readAsText(file);
        });

        function loadExampleFile() {
          fetch("init_costs_example_1762772978248.json")
            .then((response) => response.json())
            .then((exampleData) => {
              window.DATA = exampleData;
              renderAll();
            })
            .catch((error) => {
              alert("Error loading example file: " + error.message);
            });
        }

        function ilikenumbers() {
          window.iLoveNumbersIShouldMarryThem = !window.iLoveNumbersIShouldMarryThem;
          renderAll();
        }
      </script>
      <div>
        <div class="tab-group">
          <a id="btn_init" onclick='setMode("init")'>Initialize()</a>
          <a id="btn_late" onclick='setMode("late")'>LateInitialize()</a> |
        </div>
        <div class="tab-group">
          <a id="btn_total" onclick='setSort("total")'>Sort by Total Time</a>
          <a id="btn_avg" onclick='setSort("avg")'>Sort by Average Time</a>
        </div>
      </div>
      <hr />

      <div id="mainContent" style="display: none">
        <div id="summary" class="statusDisplay"></div>
        <div id="tree_root" class="runtime"></div>
      </div>
    </div>

    <script>
      Babel.registerPreset("tss", {
        presets: [[Babel.availablePresets["typescript"], { allExtensions: true }]],
      });
    </script>
    <script type="text/babel" data-presets="tss" data-type="module" lang="ts" src="index.ts?Asdfwww"></script>
    <script defer="" data-domain="monkestation.github.io" src="https://plausible.liliana.digital/js/script.js"></script>
  </body>
</html>
